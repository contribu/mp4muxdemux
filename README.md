# mp4muxdemux

A cordova plugin that can enable mp4 muxing/demuxing in iOS

[![Build Status](https://travis-ci.org/contribu/mp4muxdemux.svg?branch=master)](https://travis-ci.org/contribu/mp4muxdemux)

## Features

- mux video + audio -> mp4
- demux mp4 -> video + audio

## Install

```bash
cordova plugin add https://github.com/contribu/mp4muxdemux
```

## Usage

see tests/tests.js

## Platforms

### Supported

- iOS

### Coming Soon

- Android

### Won't

- Web

## About mp4 in iOS

https://www.apollomaniacs.com/ipod/howto_video_format.htm
https://support.apple.com/en-us/HT207022
https://www.videoproc.com/iphone-video-processing/iphone-supported-video-formats.htm

## test data

see tests/data directory.
these files are downloaded from github in test.

|name|video|audio|container|
|:-:|:-:|:-:|:-:|:-:|
|h264aaclc.mp4|h264|aac-lc|mp4|
|h265aaclc.mp4|h265|aac-lc|mp4|
|h264dolbyac3.mp4|h264|Dolby AC3|mp4|
|h265dolbyac3.mp4|h265|Dolby AC3|mp4|
|mpeg4spaaclc.mp4|MPEG4-SP|aac-lc|mp4|

h264aaclc.mp4 is a metadata anonymized version of original data captured by iphone.

other files are generated by following commands.

```bash
ffmpeg -i h264aaclc.mp4 -vcodec libx265 -acodec copy h265aaclc.mp4
ffmpeg -i h264aaclc.mp4 -vcodec copy -acodec ac3 h264dolbyac3.mp4
ffmpeg -i h264aaclc.mp4 -vcodec libx265 -acodec ac3 h265dolbyac3.mp4
ffmpeg -i h264aaclc.mp4 -vcodec mpeg4 -acodec copy mpeg4spaaclc.mp4
```

## メモ

ユースケースで不要だったので、
h264, h265, aacの組み合わせしかテストしていない。

muxで入力するファイルは拡張子を正しく指定する必要がある。
少なくともaac, h264, h265を指定可能。

オリジナルでは、
demuxで出力されるファイルは対応したもの以外は.dat拡張子で出力されるが、
トラックの種類に応じて.vide, .sounなどで出力されるように改良した。

aacはdemuxで.adts拡張子で出力される。
mux時にはaacに変える必要がある。

iphoneで撮影したmp4は音声と動画以外にもトラックが含まれており、
それらのトラックをオリジナルのdemuxerで分析すると、
コマンドは成功するが音声と動画トラックのファイルが出力されない。
音声と動画以外のトラックを無視するように改良した。

demuxerの入力がmov拡張子に対応していなかったので対応した。

## Contribution

Contributions are welcome.
Please create PR.

## License

CC0

Please note that this plugin depends on libraries licensed under BSD.
Please see deps directories.
